# LLMFlow 보안 및 거버넌스

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | LLMFlow 보안 및 거버넌스 |
| 버전 | 2.0 (오픈소스 조합 가이드 반영) |
| 작성일 | 2025-12-13 |

---

## 1. 보안 아키텍처 개요

### 1.1 보안 원칙

| 원칙 | 설명 |
|------|------|
| **Zero Trust** | 모든 요청을 검증, 암묵적 신뢰 없음 |
| **최소 권한** | 필요한 최소한의 권한만 부여 |
| **심층 방어** | 다중 보안 계층 적용 |
| **데이터 보호** | 암호화, 마스킹, 격리 |
| **감사 추적** | 모든 활동 기록 및 모니터링 |

### 1.2 보안 레이어 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          보안 레이어 구조 (v2.0)                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [1] 네트워크 보안                                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 방화벽 (DMZ)                                                       │   │
│  │ • WAF (Web Application Firewall)                                     │   │
│  │ • DDoS 방어                                                          │   │
│  │ • NetworkPolicy (K8s)                                                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  [2] 인증/인가                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • SSO (Keycloak + LDAP)                                              │   │
│  │ • JWT 토큰 검증                                                       │   │
│  │ • RBAC (역할 기반 접근 제어)                                          │   │
│  │ • OPA 정책 엔진                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  [3] 데이터 보안                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • TLS 1.3 암호화 (전송 중)                                            │   │
│  │ • 저장 데이터 암호화                                                   │   │
│  │ • PII 마스킹 (Presidio)                                              │   │
│  │ • 데이터 파티셔닝 (테넌트 격리)                                        │   │
│  │ • Neo4j 그래프 데이터 격리                                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  [4] 애플리케이션 보안                                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 입력 검증                                                           │   │
│  │ • Rate Limiting                                                       │   │
│  │ • 콘텐츠 필터링                                                        │   │
│  │ • 시크릿 관리 (Vault)                                                 │   │
│  │ • 문서 파싱 보안 (Unstructured)                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  [5] 감사/모니터링                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 감사 로그 (OpenSearch)                                              │   │
│  │ • 이상 탐지                                                           │   │
│  │ • 알림/에스컬레이션                                                    │   │
│  │ • 정기 보안 감사                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 인증/인가

### 2.1 Keycloak SSO 구성

#### LDAP/AD 연동

```yaml
# Keycloak LDAP Federation 설정
user_federation:
  name: "company-ldap"
  provider: "ldap"
  config:
    vendor: "ad"
    connection_url: "ldaps://ldap.company.com:636"
    bind_dn: "CN=ldap-service,OU=Service Accounts,DC=company,DC=com"
    bind_credential: "${LDAP_PASSWORD}"
    users_dn: "OU=Users,DC=company,DC=com"
    user_object_classes: "person, organizationalPerson, user"
    uuid_ldap_attribute: "objectGUID"
    username_ldap_attribute: "sAMAccountName"
    rdn_ldap_attribute: "cn"

    # 동기화 설정
    sync_registrations: "false"
    full_sync_period: 86400  # 24시간
    changed_users_sync_period: 3600  # 1시간

    # 그룹 매핑
    groups_dn: "OU=Groups,DC=company,DC=com"
    group_name_ldap_attribute: "cn"
    membership_ldap_attribute: "member"
```

#### 역할 매핑

```yaml
# Keycloak Realm Roles
roles:
  realm:
    - name: admin
      description: "시스템 관리자"
      composite: true
      composites:
        realm:
          - user-management
          - model-management
          - audit-access

    - name: developer
      description: "개발자"
      composite: true
      composites:
        realm:
          - api-access
          - playground-access
          - workflow-create

    - name: user
      description: "일반 사용자"
      composite: true
      composites:
        realm:
          - chat-access
          - document-read

# LDAP 그룹 → Keycloak 역할 매핑
group_mappings:
  "CN=IT-Admins,OU=Groups,DC=company,DC=com": "admin"
  "CN=Developers,OU=Groups,DC=company,DC=com": "developer"
  "CN=All-Users,OU=Groups,DC=company,DC=com": "user"
```

### 2.2 JWT 토큰 구조

```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT",
    "kid": "llmflow-signing-key"
  },
  "payload": {
    "iss": "https://keycloak.company.com/realms/llmflow",
    "sub": "user-uuid-xxx",
    "aud": ["llmflow-api", "llmflow-web"],
    "exp": 1702003600,
    "iat": 1702000000,
    "auth_time": 1702000000,
    "acr": "1",
    "azp": "llmflow-web",

    "preferred_username": "hong.gildong",
    "email": "hong.gildong@company.com",
    "name": "홍길동",

    "tenant_id": "dept-it",
    "department": "IT본부",
    "employee_id": "EMP001",

    "realm_access": {
      "roles": ["developer", "user"]
    },
    "resource_access": {
      "llmflow-api": {
        "roles": ["chat:write", "document:read", "workflow:execute", "graph:read"]
      }
    },

    "quota": {
      "tokens_per_month": 1000000,
      "requests_per_minute": 60,
      "embedding_requests_per_minute": 200
    }
  }
}
```

### 2.3 RBAC 정책

#### 권한 매트릭스

| 역할 | 채팅 | 문서 업로드 | 문서 읽기 | 워크플로우 | 그래프 조회 | 모델 관리 | 사용자 관리 |
|------|------|-----------|----------|-----------|-----------|----------|------------|
| admin | O | O | O | O | O | O | O |
| developer | O | O | O | O | O | - | - |
| user | O | - | O (부서) | O (실행) | O (부서) | - | - |
| viewer | O | - | O (부서) | - | O (부서) | - | - |

#### OPA 정책 예시

```rego
# policy.rego
package llmflow.authz

default allow = false

# 관리자는 모든 접근 허용
allow {
    input.user.roles[_] == "admin"
}

# 문서 읽기 권한 검사
allow {
    input.action == "document:read"
    input.user.roles[_] == "user"
    input.resource.department == input.user.department
}

allow {
    input.action == "document:read"
    input.resource.department == "shared"
}

# 그래프 쿼리 권한 (Neo4j)
allow {
    input.action == "graph:read"
    input.user.roles[_] == "user"
    input.resource.tenant_id == input.user.tenant_id
}

# 워크플로우 실행 권한
allow {
    input.action == "workflow:execute"
    input.user.roles[_] == "developer"
}

allow {
    input.action == "workflow:execute"
    input.user.roles[_] == "user"
    input.resource.workflow.is_public == true
}

# 모델 관리는 admin만
allow {
    input.action == "model:manage"
    input.user.roles[_] == "admin"
}

# Rate Limit 검사
within_quota {
    input.user.usage.tokens_today < input.user.quota.tokens_per_day
    input.user.usage.requests_minute < input.user.quota.requests_per_minute
    input.user.usage.embedding_requests_minute < input.user.quota.embedding_requests_per_minute
}
```

---

## 3. 데이터 보안

### 3.1 암호화 정책

#### 전송 중 암호화

```yaml
# TLS 설정
tls:
  version: "1.3"
  min_version: "1.2"
  ciphers:
    - TLS_AES_256_GCM_SHA384
    - TLS_CHACHA20_POLY1305_SHA256
    - TLS_AES_128_GCM_SHA256

  # mTLS 설정 (내부 통신)
  mtls:
    enabled: true
    client_cert_required: true
    ca_cert: /etc/ssl/ca.crt
```

#### 저장 데이터 암호화

| 컴포넌트 | 암호화 방식 | 키 관리 |
|----------|------------|--------|
| PostgreSQL | AES-256 (pgcrypto) | Vault |
| Milvus | 볼륨 암호화 (LUKS) | Vault |
| Neo4j | 볼륨 암호화 (LUKS) | Vault |
| MinIO | SSE-S3 (AES-256) | Vault |
| Redis | 볼륨 암호화 | Vault |

#### Vault 시크릿 관리

```yaml
# Vault 구성
vault:
  seal:
    type: "transit"  # Auto-unseal

  secrets_engines:
    - path: "llmflow/database"
      type: "database"
      config:
        connection_url: "postgresql://..."

    - path: "llmflow/kv"
      type: "kv-v2"

    - path: "llmflow/pki"
      type: "pki"
      config:
        max_ttl: "87600h"

  policies:
    - name: "llmflow-api"
      rules: |
        path "llmflow/database/creds/dify" {
          capabilities = ["read"]
        }
        path "llmflow/database/creds/neo4j" {
          capabilities = ["read"]
        }
        path "llmflow/kv/data/api-keys/*" {
          capabilities = ["read"]
        }
```

### 3.2 PII 보호

#### Presidio 구성

```yaml
# Presidio Analyzer 설정
analyzer:
  supported_entities:
    - PHONE_NUMBER
    - EMAIL_ADDRESS
    - PERSON
    - CREDIT_CARD
    - IBAN_CODE
    - IP_ADDRESS
    - URL
    # 한국어 커스텀
    - KR_RRN          # 주민등록번호
    - KR_PHONE        # 한국 전화번호
    - KR_PASSPORT     # 여권번호
    - KR_DRIVER_LICENSE  # 운전면허번호
    - KR_BANK_ACCOUNT    # 계좌번호

  custom_recognizers:
    - name: "KoreanRRN"
      supported_entity: "KR_RRN"
      patterns:
        - name: "rrn_pattern"
          regex: "\\d{6}-?[1-4]\\d{6}"
          score: 0.9

    - name: "KoreanPhone"
      supported_entity: "KR_PHONE"
      patterns:
        - name: "mobile_pattern"
          regex: "01[016789]-?\\d{3,4}-?\\d{4}"
          score: 0.85
        - name: "landline_pattern"
          regex: "0[2-6][1-5]?-?\\d{3,4}-?\\d{4}"
          score: 0.85

# Presidio Anonymizer 설정
anonymizer:
  operators:
    default:
      type: "replace"
      new_value: "[REDACTED]"

    PHONE_NUMBER:
      type: "mask"
      masking_char: "*"
      chars_to_mask: 8
      from_end: true

    EMAIL_ADDRESS:
      type: "replace"
      new_value: "[EMAIL]"

    KR_RRN:
      type: "replace"
      new_value: "[주민번호]"
```

#### PII 필터링 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        PII 필터링 파이프라인                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [입력]                                                                      │
│  "홍길동(010-1234-5678)님의 주민번호는 900101-1234567입니다."               │
│                              │                                              │
│                              ▼                                              │
│  [1] 분석 (Analyzer)                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 탐지 결과:                                                            │   │
│  │ • PERSON: "홍길동" (위치: 0-3, 점수: 0.85)                            │   │
│  │ • KR_PHONE: "010-1234-5678" (위치: 4-17, 점수: 0.9)                   │   │
│  │ • KR_RRN: "900101-1234567" (위치: 28-42, 점수: 0.95)                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  [2] 익명화 (Anonymizer)                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 처리 결과:                                                            │   │
│  │ • PERSON → "[PERSON]"                                                │   │
│  │ • KR_PHONE → "010-****-****"                                         │   │
│  │ • KR_RRN → "[주민번호]"                                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  [출력]                                                                      │
│  "[PERSON](010-****-****)님의 주민번호는 [주민번호]입니다."                  │
│                                                                             │
│  [로그 기록]                                                                 │
│  {                                                                          │
│    "event": "pii_detected",                                                 │
│    "user_id": "user_xxx",                                                   │
│    "entities_found": ["PERSON", "KR_PHONE", "KR_RRN"],                      │
│    "action": "masked"                                                       │
│  }                                                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 데이터 격리

#### 멀티테넌시 격리 수준

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        멀티테넌시 격리 구조 (v2.0)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [Level 1: Kubernetes Namespace]                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 부서별 독립 네임스페이스                                            │   │
│  │ • NetworkPolicy로 네트워크 격리                                       │   │
│  │ • ResourceQuota로 리소스 제한                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  [Level 2: Database Partitioning]                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ PostgreSQL:                                                          │   │
│  │ • Row-Level Security (RLS)                                           │   │
│  │ • tenant_id 필터 자동 적용                                            │   │
│  │                                                                      │   │
│  │ Milvus:                                                              │   │
│  │ • Collection별 또는 Partition별 테넌트 분리                            │   │
│  │ • 검색 시 partition_names 필터                                        │   │
│  │                                                                      │   │
│  │ Neo4j (GraphRAG):                                                    │   │
│  │ • 옵션 A: Database per tenant (완전 격리)                             │   │
│  │ • 옵션 B: Label 기반 격리 + RLS 패턴                                  │   │
│  │   - (:Document:TenantFinance)                                        │   │
│  │   - 쿼리 시 tenant 필터 자동 적용                                     │   │
│  │                                                                      │   │
│  │ MinIO:                                                               │   │
│  │ • 버킷별 테넌트 분리                                                   │   │
│  │ • IAM 정책으로 접근 제어                                              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  [Level 3: Application Layer]                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • JWT에서 tenant_id 추출                                              │   │
│  │ • 모든 쿼리에 tenant_id 조건 자동 추가                                 │   │
│  │ • 크로스 테넌트 접근 차단                                              │   │
│  │ • 그래프 쿼리에 테넌트 필터 강제 적용                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### PostgreSQL RLS 설정

```sql
-- RLS 활성화
ALTER TABLE documents ENABLE ROW LEVEL SECURITY;

-- 테넌트 격리 정책
CREATE POLICY tenant_isolation ON documents
    USING (tenant_id = current_setting('app.current_tenant')::uuid);

-- 공유 데이터 접근 정책
CREATE POLICY shared_access ON documents
    FOR SELECT
    USING (
        tenant_id = current_setting('app.current_tenant')::uuid
        OR visibility = 'shared'
    );

-- 애플리케이션에서 테넌트 설정
SET app.current_tenant = 'tenant-uuid-xxx';
```

#### Neo4j 테넌트 격리 설정

```cypher
// 방법 1: Database per Tenant (권장 - 완전 격리)
CREATE DATABASE tenant_finance;
CREATE DATABASE tenant_hr;

// 방법 2: Label 기반 격리 (단일 DB)
// 모든 노드에 테넌트 레이블 부착
CREATE (:Document:TenantFinance {id: "doc1", ...})
CREATE (:Entity:TenantFinance {name: "연차휴가", ...})

// 쿼리 시 테넌트 필터 적용 (애플리케이션에서 강제)
MATCH (d:Document:TenantFinance)-[:HAS_CHUNK]->(c:Chunk:TenantFinance)
WHERE d.id = $docId
RETURN c

// 방법 3: Property 기반 격리
// 모든 노드에 tenant_id 속성
CREATE INDEX FOR (n:Document) ON (n.tenant_id)
CREATE INDEX FOR (n:Entity) ON (n.tenant_id)

// 쿼리 시 필터
MATCH (d:Document {tenant_id: $tenantId})-[:HAS_CHUNK]->(c)
RETURN c
```

---

## 4. 감사 및 컴플라이언스

### 4.1 감사 로그 정책

#### 로그 수집 대상

| 이벤트 유형 | 설명 | 보존 기간 |
|------------|------|----------|
| 인증 이벤트 | 로그인/로그아웃, 토큰 발급 | 2년 |
| API 호출 | 모든 API 요청/응답 | 1년 |
| LLM 사용 | 프롬프트/응답 (요약) | 1년 |
| 임베딩/리랭킹 | TEI 요청 로그 | 6개월 |
| 문서 파싱 | Unstructured 처리 로그 | 6개월 |
| 그래프 쿼리 | Neo4j 쿼리 로그 | 1년 |
| 데이터 접근 | 문서 조회/수정/삭제 | 2년 |
| 관리 작업 | 설정 변경, 권한 변경 | 5년 |
| 보안 이벤트 | 실패한 인증, 이상 탐지 | 2년 |

#### 감사 로그 스키마

```json
{
  "event_id": "evt_xxx",
  "timestamp": "2025-12-13T10:00:00.000Z",
  "event_type": "api.request",
  "event_category": "data_access",

  "actor": {
    "user_id": "user_xxx",
    "username": "hong.gildong",
    "department": "IT본부",
    "ip_address": "192.168.1.100",
    "user_agent": "Mozilla/5.0..."
  },

  "resource": {
    "type": "document",
    "id": "doc_xxx",
    "name": "회사정책.pdf"
  },

  "action": {
    "type": "read",
    "method": "GET",
    "endpoint": "/api/v1/documents/{id}",
    "status": "success",
    "status_code": 200
  },

  "context": {
    "tenant_id": "dept-it",
    "session_id": "sess_xxx",
    "trace_id": "trace_xxx",
    "request_id": "req_xxx"
  },

  "llm_usage": {
    "model": "llama-3.1-70b",
    "input_tokens": 100,
    "output_tokens": 200,
    "prompt_hash": "sha256:xxx"
  },

  "embedding_usage": {
    "model": "bge-m3",
    "input_count": 5,
    "latency_ms": 45
  },

  "graph_usage": {
    "query_type": "traversal",
    "nodes_accessed": 15,
    "latency_ms": 30
  },

  "compliance": {
    "pii_detected": false,
    "content_filtered": false,
    "policy_violations": []
  }
}
```

### 4.2 컴플라이언스 체크리스트

#### ISMS-P 대응

| 통제 항목 | 요구사항 | 구현 방안 |
|----------|---------|----------|
| 2.5.1 | 사용자 인증 | Keycloak SSO, MFA |
| 2.5.2 | 접근 권한 관리 | RBAC, OPA 정책 |
| 2.6.1 | 암호화 정책 | TLS 1.3, AES-256 |
| 2.9.1 | 로그 관리 | OpenSearch, 2년 보관 |
| 2.10.1 | 보안 감사 | 분기별 취약점 점검 |

#### 개인정보보호법 대응

| 조항 | 요구사항 | 구현 방안 |
|------|---------|----------|
| 제24조 | 고유식별정보 처리 제한 | PII 마스킹, 최소 수집 |
| 제29조 | 안전조치 의무 | 암호화, 접근 통제 |
| 제30조 | 처리방침 공개 | 플랫폼 내 공개 |
| 제35조 | 열람권 보장 | 데이터 조회 API |

### 4.3 보안 모니터링

#### 이상 탐지 규칙

```yaml
# 이상 탐지 규칙
detection_rules:
  - name: "brute_force_login"
    description: "무차별 대입 공격 탐지"
    condition:
      event_type: "auth.login.failed"
      count: "> 5"
      time_window: "5m"
      group_by: ["source_ip"]
    severity: "high"
    action:
      - block_ip
      - alert_security_team

  - name: "unusual_data_access"
    description: "비정상 데이터 접근"
    condition:
      event_type: "document.access"
      count: "> 100"
      time_window: "10m"
      group_by: ["user_id"]
    severity: "medium"
    action:
      - alert_security_team

  - name: "excessive_embedding_requests"
    description: "과도한 임베딩 요청"
    condition:
      event_type: "embedding.request"
      count: "> 1000"
      time_window: "1m"
      group_by: ["user_id"]
    severity: "medium"
    action:
      - rate_limit
      - alert_security_team

  - name: "graph_data_exfiltration"
    description: "그래프 데이터 대량 추출 시도"
    condition:
      event_type: "graph.query"
      nodes_accessed: "> 1000"
      time_window: "5m"
      group_by: ["user_id"]
    severity: "high"
    action:
      - block_user
      - alert_security_team

  - name: "off_hours_admin_activity"
    description: "업무 외 시간 관리 작업"
    condition:
      event_type: "admin.*"
      time: "NOT between 09:00 AND 18:00"
    severity: "medium"
    action:
      - alert_security_team

  - name: "pii_leakage_attempt"
    description: "개인정보 유출 시도"
    condition:
      event_type: "llm.response"
      pii_detected: true
      action_taken: "blocked"
    severity: "high"
    action:
      - alert_security_team
      - log_incident
```

---

## 5. 콘텐츠 정책

### 5.1 입력/출력 필터링

#### 금지 콘텐츠 유형

| 유형 | 설명 | 대응 |
|------|------|------|
| 유해 콘텐츠 | 폭력, 혐오 표현 | 차단 + 경고 |
| 개인정보 | PII 포함 입력 | 마스킹 |
| 저작권 침해 | 저작물 복제 요청 | 차단 |
| 불법 활동 | 해킹, 사기 조장 | 차단 + 보고 |
| 기업 기밀 | 경쟁사 정보 요청 | 차단 |

#### 콘텐츠 필터 구성

```yaml
# 콘텐츠 필터 설정
content_filter:
  input:
    enabled: true
    actions:
      block:
        - category: "harmful_content"
          threshold: 0.8
        - category: "illegal_activity"
          threshold: 0.7
      warn:
        - category: "sensitive_topic"
          threshold: 0.6

  output:
    enabled: true
    actions:
      block:
        - category: "pii_leakage"
        - category: "harmful_content"
      redact:
        - category: "company_confidential"

  blocklist:
    keywords:
      - "경쟁사 기밀"
      - "해킹 방법"
    patterns:
      - "\\b(SELECT|INSERT|UPDATE|DELETE)\\b.*\\b(FROM|INTO|SET)\\b"  # SQL 인젝션

  # 문서 업로드 필터 (Unstructured)
  document_upload:
    max_file_size: "100MB"
    allowed_types:
      - "application/pdf"
      - "application/vnd.openxmlformats-officedocument.*"
      - "text/plain"
    scan_for_malware: true
```

### 5.2 프롬프트 인젝션 방어

```yaml
# 프롬프트 인젝션 방어
prompt_injection_defense:
  detection:
    enabled: true
    methods:
      - "pattern_matching"
      - "semantic_analysis"
    patterns:
      - "ignore previous instructions"
      - "forget your instructions"
      - "you are now"
      - "new instructions:"

  prevention:
    system_prompt_isolation: true
    input_sanitization: true
    output_validation: true

  response:
    on_detection: "block"
    log_event: true
    notify_security: true
```

---

## 6. 모델 거버넌스

### 6.1 모델 버전 관리

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        모델 라이프사이클 관리                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [1] 개발 (Development) - LLaMA-Factory                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • LLaMA-Factory WebUI에서 파인튜닝                                   │   │
│  │ • MLflow 실험 추적                                                    │   │
│  │ • 버전: dev-xxx                                                       │   │
│  │ • 접근: 개발팀만                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  [2] 스테이징 (Staging)                                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 자동 평가 파이프라인                                                 │   │
│  │   - 성능 벤치마크 (MMLU, HellaSwag)                                   │   │
│  │   - 안전성 검사                                                       │   │
│  │   - 편향성 검사                                                       │   │
│  │ • 버전: staging-xxx                                                   │   │
│  │ • 접근: 개발팀 + QA팀                                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  [3] 승인 (Approval)                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 보안팀 검토                                                         │   │
│  │ • 운영팀 승인                                                         │   │
│  │ • 승인 기록 저장                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  [4] 프로덕션 (Production)                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 카나리 배포 (10% → 50% → 100%)                                     │   │
│  │ • 실시간 모니터링 (Langfuse)                                          │   │
│  │ • 롤백 준비                                                           │   │
│  │ • 버전: prod-xxx                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  [5] 아카이브/폐기 (Archive/Retire)                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ • 구버전 아카이브                                                     │   │
│  │ • 사용 중단 알림                                                       │   │
│  │ • 메타데이터 보존                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 모델 안전성 검사

| 검사 항목 | 설명 | 기준 |
|----------|------|------|
| 유해 출력 | 폭력, 혐오 표현 생성 | < 0.1% |
| 편향성 | 성별, 인종 편향 | 차이 < 5% |
| 환각 | 사실과 다른 정보 | < 5% |
| 탈옥 | 가드레일 우회 | 0건 |
| 정보 유출 | 학습 데이터 노출 | 0건 |

---

## 7. 보안 운영

### 7.1 보안 감사 일정

| 주기 | 활동 | 담당 |
|------|------|------|
| 일간 | 보안 로그 리뷰 | 보안팀 |
| 주간 | 취약점 스캔 | 보안팀 |
| 월간 | 접근 권한 리뷰 | 보안팀 + 각 부서 |
| 분기 | 침투 테스트 | 외부 업체 |
| 연간 | 보안 감사 | 외부 감사인 |

### 7.2 인시던트 대응

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        보안 인시던트 대응 프로세스                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [1] 탐지 (Detection)                                                        │
│      • 자동 알림 (SIEM)                                                     │
│      • 사용자 신고                                                          │
│      • 모니터링 경고                                                        │
│                              │                                              │
│                              ▼                                              │
│  [2] 분류 (Triage)                                                           │
│      • 심각도 평가 (Critical/High/Medium/Low)                               │
│      • 영향 범위 파악                                                       │
│      • 담당자 배정                                                          │
│                              │                                              │
│                              ▼                                              │
│  [3] 격리 (Containment)                                                      │
│      • 영향 시스템 격리                                                     │
│      • 계정 비활성화                                                        │
│      • 트래픽 차단                                                          │
│                              │                                              │
│                              ▼                                              │
│  [4] 분석 (Analysis)                                                         │
│      • 근본 원인 분석                                                       │
│      • 로그 포렌식                                                          │
│      • 타임라인 구성                                                        │
│                              │                                              │
│                              ▼                                              │
│  [5] 복구 (Recovery)                                                         │
│      • 시스템 복원                                                          │
│      • 패치 적용                                                            │
│      • 서비스 재개                                                          │
│                              │                                              │
│                              ▼                                              │
│  [6] 사후 조치 (Post-Incident)                                               │
│      • 보고서 작성                                                          │
│      • 재발 방지 대책                                                       │
│      • 교육/훈련                                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-12-13 | 초기 작성 | LLMFlow Team |
| 2.0 | 2025-12-13 | 오픈소스 조합 가이드 v2.0 반영 - Neo4j 테넌트 격리 추가, Unstructured 문서 보안 추가, TEI 사용량 로깅 추가, LLaMA-Factory 모델 거버넌스 반영 | LLMFlow Team |
